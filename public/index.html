<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ERIC.exe Live Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* ... your existing CSS here ... */
    /* For brevity, just keep the CSS from your last version */
    /* I'll include a simple snippet so you know where it goes */
    body {
      background: #0f111a;
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    /* Add the rest of your CSS here */
    /* ... */
  </style>
</head>
<body>

  <div id="bootScreen">
    <h1 id="bootTitle">ERIC.exe</h1>
    <p id="bootMeaning">Experimental Reactive Intelligence Core</p>
  </div>

  <header>ERIC.exe Live Chat</header>

  <div id="chat"></div>

  <form id="chatForm">
    <input type="text" id="messageInput" placeholder="Type a message..." autocomplete="off" required />
    <button type="submit">Send</button>
  </form>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Boot screen fade out
    window.addEventListener("DOMContentLoaded", () => {
      const bootScreen = document.getElementById("bootScreen");
      setTimeout(() => {
        bootScreen.style.display = "none";
      }, 6000);
    });

    const socket = io();

    // Simple username prompt UI
    function askUsername() {
      return new Promise((resolve) => {
        const container = document.createElement('div');
        container.style.position = 'fixed';
        container.style.top = 0;
        container.style.left = 0;
        container.style.right = 0;
        container.style.bottom = 0;
        container.style.background = 'rgba(15,17,26,0.95)';
        container.style.display = 'flex';
        container.style.flexDirection = 'column';
        container.style.justifyContent = 'center';
        container.style.alignItems = 'center';
        container.style.zIndex = '9999';

        const label = document.createElement('label');
        label.textContent = 'Enter your username:';
        label.style.color = '#ff5722';
        label.style.fontSize = '1.5rem';
        label.style.marginBottom = '1rem';

        const input = document.createElement('input');
        input.type = 'text';
        input.style.padding = '10px 15px';
        input.style.fontSize = '1.2rem';
        input.style.borderRadius = '8px';
        input.style.border = 'none';
        input.style.outline = 'none';
        input.style.width = '250px';
        input.autocomplete = 'off';

        const btn = document.createElement('button');
        btn.textContent = 'Join Chat';
        btn.style.marginTop = '1rem';
        btn.style.padding = '10px 20px';
        btn.style.fontSize = '1.2rem';
        btn.style.borderRadius = '8px';
        btn.style.border = 'none';
        btn.style.background = '#ff5722';
        btn.style.color = '#fff';
        btn.style.cursor = 'pointer';

        btn.addEventListener('click', () => {
          if (input.value.trim()) {
            resolve(input.value.trim());
            document.body.removeChild(container);
          }
        });

        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter' && input.value.trim()) {
            e.preventDefault();
            resolve(input.value.trim());
            document.body.removeChild(container);
          }
        });

        container.appendChild(label);
        container.appendChild(input);
        container.appendChild(btn);
        document.body.appendChild(container);
        input.focus();
      });
    }

    let username;

    askUsername().then(name => {
      username = name;
    });

    const chat = document.getElementById('chat');
    const form = document.getElementById('chatForm');
    const input = document.getElementById('messageInput');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!username) {
        alert("Please enter a username first!");
        return;
      }
      const msg = input.value.trim();
      if (!msg) return;
      socket.emit('chat message', { user: username, text: msg });
      input.value = '';
    });

    // Receive chat history on connect
    socket.on('chat history', (msgs) => {
      msgs.forEach(data => {
        const sender = data.user === username ? 'user' : 'other';
        addMessage(`${data.user}: ${data.text}`, sender);
      });
    });

    socket.on('chat message', (data) => {
      // Avoid duplicating own message from history
      const lastMessage = chat.lastChild;
      if (lastMessage && lastMessage.textContent === `${data.user}: ${data.text}`) return;

      const sender = data.user === username ? 'user' : 'other';
      addMessage(`${data.user}: ${data.text}`, sender);
    });

    function addMessage(text, sender) {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message', sender);
      msgDiv.textContent = text;
      chat.appendChild(msgDiv);
      chat.scrollTop = chat.scrollHeight;
    }
  </script>

</body>
</html>
